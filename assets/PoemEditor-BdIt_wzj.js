import{c as h,r as a,n as ie,u as ce,g as le,m as W,j as e}from"./index-CGtm6Oha.js";import{E as de,S as ue,D as pe}from"./index-DgB27Zzc.js";import{X as G}from"./x-6R3rlTRp.js";import{T as ye,C as ge}from"./tag-BWwJLy7a.js";const me=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],he=h("bold",me);const fe=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],be=h("eye-off",fe);const xe=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],we=h("italic",xe);const ke=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ve=h("lock",ke);const je=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],Se=h("mic-off",je);const ze=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Ce=h("mic",ze);const Me=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ee=h("save",Me);const Ne=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],Te=h("underline",Ne),$e=i=>{a.useEffect(()=>{const d=n=>{for(const o of i){const c=n.key.toLowerCase()===o.key.toLowerCase(),g=o.ctrlKey===void 0||n.ctrlKey===o.ctrlKey,s=o.shiftKey===void 0||n.shiftKey===o.shiftKey,y=o.altKey===void 0||n.altKey===o.altKey,u=o.metaKey===void 0||n.metaKey===o.metaKey;if(c&&g&&s&&y&&u){const k=n.target;if((k.tagName==="INPUT"||k.tagName==="TEXTAREA"||k.isContentEditable)&&n.key!=="Escape")continue;n.preventDefault(),o.callback(n);break}}};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[i])};class _e{static parse(d){let n=d;return n=n.replace(/^### (.*$)/gim,"<h3>$1</h3>"),n=n.replace(/^## (.*$)/gim,"<h2>$1</h2>"),n=n.replace(/^# (.*$)/gim,"<h1>$1</h1>"),n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),n=n.replace(/__(.+?)__/g,"<strong>$1</strong>"),n=n.replace(/\*(.+?)\*/g,"<em>$1</em>"),n=n.replace(/_(.+?)_/g,"<em>$1</em>"),n=n.replace(/~~(.+?)~~/g,"<del>$1</del>"),n=n.replace(/\[([^\]]+)\]\(([^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),n=n.replace(/\n/g,"<br/>"),n}static strip(d){return d.replace(/[#*_~\[\]()]/g,"").replace(/\n/g," ").trim()}}class q{static encoder=new TextEncoder;static decoder=new TextDecoder;static async generateKey(d){const n=await window.crypto.subtle.importKey("raw",this.encoder.encode(d),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:this.encoder.encode("poeset-salt-v1"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async encrypt(d,n){try{const o=await this.generateKey(n),c=window.crypto.getRandomValues(new Uint8Array(12)),g=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},o,this.encoder.encode(d)),s=new Uint8Array(c.length+g.byteLength);return s.set(c),s.set(new Uint8Array(g),c.length),btoa(String.fromCharCode(...s))}catch(o){throw console.error("Encryption failed:",o),new Error("Failed to encrypt content")}}static async decrypt(d,n){try{const o=await this.generateKey(n),c=Uint8Array.from(atob(d),u=>u.charCodeAt(0)),g=c.slice(0,12),s=c.slice(12),y=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:g},o,s);return this.decoder.decode(y)}catch(o){throw console.error("Decryption failed:",o),new Error("Failed to decrypt content - wrong password?")}}}const Ae=({poem:i,onSave:d,onClose:n,initialDate:o})=>{const[c,g]=a.useState(i?.title||""),[s,y]=a.useState(i?.content||""),[u,k]=a.useState(i?.tags||[]),[z,A]=a.useState(""),[C,X]=a.useState(i?.date.split("T")[0]||o||new Date().toISOString().split("T")[0]),[f,_]=a.useState(i?.mood),[P,Y]=a.useState(!1),[B,J]=a.useState(!1),[L,Q]=a.useState(!1),[ee,O]=a.useState(!1),[v,te]=a.useState(!1),[j,H]=a.useState(i?.isEncrypted||!1),[ne,M]=a.useState(!1),[E,T]=a.useState(""),[b,I]=a.useState(!1),N=a.useRef(null),$=a.useRef(i?.id||""),S=a.useRef(null),x=ie(),{t:R}=ce(),re=a.useMemo(()=>"webkitSpeechRecognition"in window||"SpeechRecognition"in window,[]),U=a.useMemo(()=>{if(!z)return[];const t=le(),r=new Set;return t.forEach(l=>{l.tags.forEach(m=>r.add(m))}),Array.from(r).filter(l=>l.toLowerCase().includes(z.toLowerCase())&&!u.includes(l)).slice(0,5)},[z,u]);a.useEffect(()=>{$.current||($.current=`poem-${Date.now()}-${Math.random().toString(36).substr(2,9)}`)},[]),a.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.webkitSpeechRecognition||window.SpeechRecognition,r=new t;r.continuous=!0,r.interimResults=!0,r.lang=x.language==="pl"?"pl-PL":"en-US",r.onresult=l=>{let m="";for(let p=l.resultIndex;p<l.results.length;p++){const w=l.results[p][0].transcript;l.results[p].isFinal&&(m+=w+" ")}m&&y(p=>p+m)},r.onerror=l=>{console.error("Speech recognition error:",l.error),I(!1)},r.onend=()=>{b&&r.start()},S.current=r}return()=>{S.current&&S.current.stop()}},[x.language,b]);const ae=a.useCallback(()=>{S.current&&(b?(S.current.stop(),I(!1)):(S.current.start(),I(!0)))},[b]);a.useEffect(()=>{if(s.trim())return N.current&&clearTimeout(N.current),N.current=window.setTimeout(()=>{const t=new Date().toISOString(),r={id:$.current,title:c.trim()||"Bez tytułu",content:s.trim(),date:`${C}T${new Date().toISOString().split("T")[1]}`,tags:u,mood:f,collectionIds:i?.collectionIds||[],createdAt:i?.createdAt||t,updatedAt:t};W(r),O(!0),setTimeout(()=>O(!1),2e3)},3e3),()=>{N.current&&clearTimeout(N.current)}},[c,s,u,f,C,i]);const F=a.useCallback(()=>{if(!s.trim())return;const t=new Date().toISOString(),r={id:$.current,title:c.trim()||"Bez tytułu",content:s.trim(),date:`${C}T${new Date().toISOString().split("T")[1]}`,tags:u,mood:f,collectionIds:i?.collectionIds||[],createdAt:i?.createdAt||t,updatedAt:t};W(r),d(r)},[s,c,C,u,f,i,d]),D=t=>{const r=(t||z).trim();r&&!u.includes(r)&&(k([...u,r]),A(""))},se=t=>{k(u.filter(r=>r!==t))},K=t=>{const r=document.querySelector("textarea");if(!r)return;const l=r.selectionStart,m=r.selectionEnd,p=s.substring(l,m);if(!p)return;let w="";switch(t){case"bold":w=`**${p}**`;break;case"italic":w=`*${p}*`;break;case"underline":w=`__${p}__`;break}const oe=s.substring(0,l)+w+s.substring(m);y(oe),setTimeout(()=>{r.focus(),r.setSelectionRange(l,l+w.length)},0)},Z=async()=>{if(E.trim())try{const t=await q.encrypt(s,E);y(t),H(!0),M(!1),T("")}catch{alert("Błąd szyfrowania")}},V=async()=>{if(E.trim())try{const t=await q.decrypt(s,E);y(t),H(!1),M(!1),T("")}catch{alert("Nieправидłowe hasło")}};return $e([{key:"s",ctrlKey:!0,callback:F,description:"Save (Ctrl+S)"},{key:"Escape",callback:n,description:"Close (Esc)"}]),e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"var(--light-bg)",zIndex:1e3,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{className:"button button-secondary",onClick:n,style:{padding:"0.5rem"},children:e.jsx(G,{size:20})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[ee&&e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginRight:"0.5rem"},children:"✓ Zapisano"}),x.enableMarkdown&&e.jsx("button",{className:"button button-secondary",onClick:()=>te(!v),style:{padding:"0.5rem"},title:v?"Ukryj podgląd":"Pokaż podgląd Markdown",children:v?e.jsx(be,{size:20}):e.jsx(de,{size:20})}),re&&e.jsx("button",{className:`button ${b?"button-primary":"button-secondary"}`,onClick:ae,style:{padding:"0.5rem"},title:b?"Zatrzymaj dyktowanie":"Rozpocznij dyktowanie",children:b?e.jsx(Se,{size:20}):e.jsx(Ce,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:()=>Y(!P),style:{padding:"0.5rem"},children:e.jsx(ye,{size:20})}),e.jsx("button",{className:`button ${j?"button-primary":"button-secondary"}`,onClick:()=>M(!0),style:{padding:"0.5rem"},title:j?"Wiersz zaszyfrowany":"Zaszyfruj wiersz",children:e.jsx(ve,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:()=>Q(!L),style:{padding:"0.5rem"},title:"Nastrój wiersza",children:e.jsx(ue,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:()=>J(!B),style:{padding:"0.5rem"},children:e.jsx(ge,{size:20})}),e.jsxs("button",{className:"button button-primary",onClick:F,disabled:!s.trim(),children:[e.jsx(Ee,{size:20}),"Zapisz"]})]})]}),P&&e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{position:"relative",flex:1},children:[e.jsx("input",{type:"text",className:"input",placeholder:"Dodaj tag...",value:z,onChange:t=>A(t.target.value),onKeyPress:t=>t.key==="Enter"&&D(),style:{padding:"0.5rem",width:"100%"}}),U.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"0.25rem",background:"var(--bg-primary)",border:"1px solid var(--border-color)",borderRadius:"0.5rem",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:U.map(t=>e.jsx("div",{onClick:()=>D(t),style:{padding:"0.75rem",cursor:"pointer",borderBottom:"1px solid var(--border-color)",fontSize:"0.875rem"},onMouseEnter:r=>{r.currentTarget.style.background="var(--bg-secondary)"},onMouseLeave:r=>{r.currentTarget.style.background="transparent"},children:t},t))})]}),e.jsx("button",{className:"button button-primary",onClick:()=>D(),children:"Dodaj"})]}),u.length>0&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:u.map(t=>e.jsxs("span",{style:{fontSize:"0.875rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--light-border)",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},onClick:()=>se(t),children:[t," ",e.jsx(G,{size:14})]},t))})]}),L&&e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",opacity:.7},children:R.filters.mood}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"0.5rem"},children:[e.jsx("button",{className:`button ${f?"button-secondary":"button-primary"}`,onClick:()=>_(void 0),style:{fontSize:"0.875rem"},children:R.poems.allMoods}),pe.map(t=>e.jsx("button",{className:`button ${f===t?"button-primary":"button-secondary"}`,onClick:()=>_(t),style:{fontSize:"0.875rem"},children:R.mood[t]},t)),x.customMoods.map(t=>e.jsx("button",{className:`button ${f===t?"button-primary":"button-secondary"}`,onClick:()=>_(t),style:{fontSize:"0.875rem"},children:t},t))]})]}),B&&e.jsx("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)"},children:e.jsx("input",{type:"date",className:"input",value:C,onChange:t=>X(t.target.value),style:{padding:"0.5rem"}})}),ne&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>M(!1),children:e.jsxs("div",{style:{background:"var(--bg-primary)",padding:"var(--spacing-lg)",borderRadius:"0.5rem",maxWidth:"400px",width:"90%"},onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:"var(--spacing-md)"},children:j?"Odszyfruj wiersz":"Zaszyfruj wiersz"}),e.jsx("input",{type:"password",className:"input",placeholder:"Hasło",value:E,onChange:t=>T(t.target.value),onKeyPress:t=>t.key==="Enter"&&(j?V():Z()),style:{marginBottom:"var(--spacing-md)"}}),e.jsxs("div",{style:{display:"flex",gap:"var(--spacing-sm)"},children:[e.jsx("button",{className:"button button-primary",onClick:j?V:Z,style:{flex:1},children:j?"Odszyfruj":"Zaszyfruj"}),e.jsx("button",{className:"button button-secondary",onClick:()=>{M(!1),T("")},style:{flex:1},children:"Anuluj"})]})]})}),e.jsxs("div",{style:{flex:1,padding:"var(--spacing-xl)",overflow:"auto",display:v&&x.enableMarkdown?"grid":"block",gridTemplateColumns:v&&x.enableMarkdown?"1fr 1fr":"1fr",gap:"var(--spacing-lg)"},children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",className:"input font-serif",placeholder:"Tytuł (opcjonalny)",value:c,onChange:t=>g(t.target.value),style:{fontSize:"1.5rem",fontWeight:500,marginBottom:"var(--spacing-lg)",border:"none",padding:"0"}}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem",marginBottom:"var(--spacing-md)",paddingBottom:"var(--spacing-sm)",borderBottom:"1px solid var(--light-border)"},children:[e.jsx("button",{className:"button button-secondary",onClick:()=>K("bold"),style:{padding:"0.5rem",fontSize:"0.875rem"},title:"Pogrubienie (zaznacz tekst)",children:e.jsx(he,{size:16})}),e.jsx("button",{className:"button button-secondary",onClick:()=>K("italic"),style:{padding:"0.5rem",fontSize:"0.875rem"},title:"Kursywa (zaznacz tekst)",children:e.jsx(we,{size:16})}),e.jsx("button",{className:"button button-secondary",onClick:()=>K("underline"),style:{padding:"0.5rem",fontSize:"0.875rem"},title:"Podkreślenie (zaznacz tekst)",children:e.jsx(Te,{size:16})}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",marginLeft:"0.5rem"},children:"Zaznacz tekst i kliknij aby sformatować"})]}),e.jsx("textarea",{className:"input textarea font-serif",placeholder:"Zacznij pisać wiersz...",value:s,onChange:t=>y(t.target.value),style:{border:"none",padding:"0",fontSize:"1.125rem",lineHeight:1.8,minHeight:"400px"},autoFocus:!0})]}),v&&x.enableMarkdown&&e.jsxs("div",{style:{borderLeft:"2px solid var(--light-border)",paddingLeft:"var(--spacing-lg)"},children:[e.jsx("h3",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:"var(--spacing-lg)",opacity:.7},children:c||"Bez tytułu"}),e.jsx("div",{className:"markdown-preview",style:{fontSize:"1.125rem",lineHeight:1.8,whiteSpace:"pre-wrap"},dangerouslySetInnerHTML:{__html:_e.parse(s)}})]})]})]})};export{Ae as P,Ee as S,$e as u};
