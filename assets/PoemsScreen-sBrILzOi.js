import{c as M,r as n,j as e,u as N,g as w}from"./index-DhixKQJC.js";import{P as R}from"./PoemViewer-D2-zE9re.js";import{u as k,f as L,p as E,e as T}from"./PoemEditor-CsvSNxbS.js";import"./differenceInCalendarDays-D6rsNAWq.js";const z=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],B=M("search",z),D=({content:s,children:f,maxWidth:x=300,delay:h=500})=>{const[y,o]=n.useState(!1),[g,u]=n.useState({top:0,left:0}),d=n.useRef(null),a=n.useRef(null),l=n.useRef(null),m=()=>{l.current=setTimeout(()=>{const c=a.current?.getBoundingClientRect();c&&(u({top:c.bottom+window.scrollY+8,left:c.left+window.scrollX+c.width/2}),o(!0))},h)},j=()=>{l.current&&clearTimeout(l.current),o(!1)};return n.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),e.jsxs("div",{ref:a,className:"tooltip-container",onMouseEnter:m,onMouseLeave:j,children:[f,y&&e.jsx("div",{ref:d,className:"tooltip",style:{top:`${g.top}px`,left:`${g.left}px`,maxWidth:`${x}px`},children:s})]})},v=20,U=()=>{const{t:s,language:f}=N(),x=f==="pl"?E:T,[h,y]=n.useState(()=>w()),[o,g]=n.useState(""),[u,d]=n.useState(null),[a,l]=n.useState("newest"),[m,j]=n.useState(v),c=n.useRef(null);k([{key:"f",ctrlKey:!0,callback:()=>c.current?.focus(),description:"Search (Ctrl+F)"},{key:"Escape",callback:()=>u&&d(null),description:"Close (Esc)"}]);const i=n.useMemo(()=>{let t=[...h];return o&&(t=t.filter(r=>r.title.toLowerCase().includes(o.toLowerCase())||r.content.toLowerCase().includes(o.toLowerCase())||r.tags.some(p=>p.toLowerCase().includes(o.toLowerCase())))),t.sort((r,p)=>{switch(a){case"newest":return new Date(p.date).getTime()-new Date(r.date).getTime();case"oldest":return new Date(r.date).getTime()-new Date(p.date).getTime();case"alphabetical":return r.title.localeCompare(p.title);default:return 0}}),t},[h,o,a]),b=n.useMemo(()=>i.slice(0,m),[i,m]),S=m<i.length,C=()=>{const t=w();y(t),d(null)},P=()=>{j(t=>t+v)};return e.jsxs("div",{style:{padding:"var(--spacing-lg)"},children:[e.jsxs("header",{style:{marginBottom:"var(--spacing-xl)"},children:[e.jsx("h1",{style:{fontSize:"2rem",marginBottom:"0.5rem",fontWeight:300},children:s.poems.title}),e.jsx("p",{className:"text-secondary",children:s.poems.subtitle})]}),e.jsxs("div",{style:{marginBottom:"var(--spacing-lg)"},children:[e.jsxs("div",{style:{position:"relative",marginBottom:"var(--spacing-md)"},children:[e.jsx(B,{size:20,style:{position:"absolute",left:"1rem",top:"50%",transform:"translateY(-50%)",opacity:.5}}),e.jsx("input",{ref:c,type:"text",className:"input",placeholder:s.poems.search,value:o,onChange:t=>g(t.target.value),style:{paddingLeft:"3rem"}})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("button",{className:`button ${a==="newest"?"button-primary":"button-secondary"}`,onClick:()=>l("newest"),style:{fontSize:"0.875rem",padding:"0.5rem 1rem"},children:s.poems.newest}),e.jsx("button",{className:`button ${a==="oldest"?"button-primary":"button-secondary"}`,onClick:()=>l("oldest"),style:{fontSize:"0.875rem",padding:"0.5rem 1rem"},children:s.poems.oldest}),e.jsx("button",{className:`button ${a==="alphabetical"?"button-primary":"button-secondary"}`,onClick:()=>l("alphabetical"),style:{fontSize:"0.875rem",padding:"0.5rem 1rem"},children:s.poems.alphabetical})]})]}),i.length===0?e.jsx("div",{style:{textAlign:"center",padding:"3rem 1rem"},children:e.jsx("p",{className:"text-secondary",children:o?s.poems.noResults:s.poems.noPoems})}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-secondary mb-md",style:{fontSize:"0.875rem"},children:[i.length," ",i.length===1?s.poems.countSingular:s.poems.count,b.length<i.length&&e.jsxs("span",{children:[" (",s.poems.shown," ",b.length,")"]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-md)"},children:b.map(t=>e.jsx(D,{content:e.jsxs("div",{className:"tooltip-content-preview",children:[e.jsx("strong",{children:t.title||s.editor.untitled}),e.jsx("br",{}),t.content.substring(0,200),t.content.length>200&&"..."]}),delay:800,children:e.jsxs("div",{className:"card",onClick:()=>d(t),children:[e.jsx("h3",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.title||s.editor.untitled}),e.jsx("p",{className:"text-secondary",style:{fontSize:"0.875rem",marginBottom:"1rem"},children:L(new Date(t.date),"d MMMM yyyy",{locale:x})}),e.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6,maxHeight:"100px",overflow:"hidden",textOverflow:"ellipsis"},children:t.content}),t.tags.length>0&&e.jsxs("div",{style:{marginTop:"1rem",display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[t.tags.slice(0,3).map(r=>e.jsx("span",{style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--light-border)"},children:r},r)),t.tags.length>3&&e.jsxs("span",{style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--light-border)"},children:["+",t.tags.length-3]})]})]})},t.id))}),S&&e.jsxs("button",{className:"button button-secondary",onClick:P,style:{marginTop:"var(--spacing-lg)",width:"100%"},children:[s.poems.loadMore," (",i.length-m," ",s.poems.remaining,")"]})]}),u&&e.jsx(R,{poem:u,onClose:()=>d(null),onUpdate:C})]})};export{U as default};
