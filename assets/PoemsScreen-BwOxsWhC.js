import{c as C,r as l,j as e,u as J,g as T,b as ee,d as te,e as se,f as ne}from"./index-ELLU4lrs.js";import{T as le}from"./Modal-BZKOp3Ib.js";import{u as oe,D as ae,M as ie}from"./PoemEditor-C6-_1iBT.js";import{P as re}from"./PoemViewer-B1fidZIw.js";import{f as ce,p as de,e as me}from"./pl-Bq6CFB2J.js";import"./x-DePGdsmI.js";import"./eye-CIulwnSG.js";import"./tag-CrUzLx7h.js";import"./plus-mGinGNZo.js";const ue=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],pe=C("folder-plus",ue);const he=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ge=C("funnel",he);const ye=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],xe=C("search",ye);const fe=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],be=C("square-check-big",fe),je=({content:n,children:M,maxWidth:N=300,delay:b=500})=>{const[j,i]=l.useState(!1),[S,r]=l.useState({top:0,left:0}),u=l.useRef(null),p=l.useRef(null),c=l.useRef(null),B=()=>{c.current=setTimeout(()=>{const x=p.current?.getBoundingClientRect();x&&(r({top:x.bottom+window.scrollY+8,left:x.left+window.scrollX+x.width/2}),i(!0))},b)},y=()=>{c.current&&clearTimeout(c.current),i(!1)};return l.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),e.jsxs("div",{ref:p,className:"tooltip-container",onMouseEnter:B,onMouseLeave:y,children:[M,j&&e.jsx("div",{ref:u,className:"tooltip",style:{top:`${S.top}px`,left:`${S.left}px`,maxWidth:`${N}px`},children:n})]})},$=20,De=()=>{const{t:n,language:M}=J(),N=M==="pl"?de:me,[b,j]=l.useState(()=>T()),[i,S]=l.useState(""),[r,u]=l.useState(null),[p,c]=l.useState("newest"),B=ee(),[y,x]=l.useState($),[D,W]=l.useState(!1),[v,I]=l.useState(""),[k,R]=l.useState(""),[w,A]=l.useState(""),[z,_]=l.useState(""),[h,P]=l.useState([]),[g,E]=l.useState(!1),[a,f]=l.useState(new Set),[H,L]=l.useState(!1),F=l.useRef(null);oe([{key:"f",ctrlKey:!0,callback:()=>F.current?.focus(),description:"Search (Ctrl+F)"},{key:"Escape",callback:()=>r&&u(null),description:"Close (Esc)"},{key:"ArrowLeft",callback:()=>{if(r){const t=o.findIndex(s=>s.id===r.id);t>0&&u(o[t-1])}},description:"Poprzedni wiersz (←)"},{key:"ArrowRight",callback:()=>{if(r){const t=o.findIndex(s=>s.id===r.id);t<o.length-1&&u(o[t+1])}},description:"Następny wiersz (→)"}]);const o=l.useMemo(()=>{let t=[...b];return i&&(t=t.filter(s=>s.title.toLowerCase().includes(i.toLowerCase())||s.content.toLowerCase().includes(i.toLowerCase())||s.tags.some(m=>m.toLowerCase().includes(i.toLowerCase())))),v&&(t=t.filter(s=>s.date>=v)),k&&(t=t.filter(s=>s.date<=k+"T23:59:59")),w&&(t=t.filter(s=>s.content.length>=parseInt(w))),z&&(t=t.filter(s=>s.content.length<=parseInt(z))),h.length>0&&(t=t.filter(s=>Array.isArray(s.moods)&&s.moods.length>0?s.moods.some(m=>h.includes(m)):!1)),t.sort((s,m)=>{switch(p){case"newest":return new Date(m.date).getTime()-new Date(s.date).getTime();case"oldest":return new Date(s.date).getTime()-new Date(m.date).getTime();case"alphabetical":return s.title.localeCompare(m.title);default:return 0}}),t},[b,i,p,v,k,w,z,h]),d=l.useMemo(()=>o.slice(0,y),[o,y]),V=y<o.length,O=()=>{const t=T();j(t),u(null)},U=()=>{E(!g),f(new Set)},q=t=>{const s=new Set(a);s.has(t)?s.delete(t):s.add(t),f(s)},Z=()=>{a.size===d.length?f(new Set):f(new Set(d.map(t=>t.id)))},{notify:Se}=te(),[ve,K]=l.useState(!1),[ke,Q]=l.useState(0),Y=()=>{a.size!==0&&(Q(a.size),K(!0))},G=t=>{a.forEach(m=>{ne(m,t)});const s=T();j(s),f(new Set),L(!1),E(!1)},X=()=>{x(t=>t+$)};return e.jsxs("div",{style:{padding:"var(--spacing-lg)"},children:[e.jsxs("header",{style:{marginBottom:"var(--spacing-xl)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsx("h1",{style:{fontSize:"2rem",margin:0,fontWeight:300},children:n.poems.title}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[g&&a.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"button button-secondary",onClick:()=>L(!0),style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(pe,{size:18}),"Dodaj do kolekcji (",a.size,")"]}),e.jsxs("button",{className:"button button-secondary",onClick:Y,style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#ef4444"},children:[e.jsx(le,{size:18}),"Usuń (",a.size,")"]})]}),e.jsxs("button",{className:`button ${g?"button-primary":"button-secondary"}`,onClick:U,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(be,{size:18}),g?"Anuluj":"Zaznacz"]})]})]}),e.jsx("p",{className:"text-secondary",children:n.poems.subtitle})]}),e.jsxs("div",{style:{marginBottom:"var(--spacing-lg)"},children:[e.jsxs("div",{style:{position:"relative",marginBottom:"var(--spacing-md)"},children:[e.jsx(xe,{size:20,style:{position:"absolute",left:"1rem",top:"50%",transform:"translateY(-50%)",opacity:.5}}),e.jsx("input",{ref:F,type:"text",className:"input",placeholder:n.poems.search,value:i,onChange:t=>S(t.target.value),style:{paddingLeft:"3rem"}})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("button",{className:`button ${p==="newest"?"button-primary":"button-secondary"}`,onClick:()=>c("newest"),style:{fontSize:"0.875rem",padding:"0.5rem 1rem"},children:n.poems.newest}),e.jsx("button",{className:`button ${p==="oldest"?"button-primary":"button-secondary"}`,onClick:()=>c("oldest"),style:{fontSize:"0.875rem",padding:"0.5rem 1rem"},children:n.poems.oldest}),e.jsx("button",{className:`button ${p==="alphabetical"?"button-primary":"button-secondary"}`,onClick:()=>c("alphabetical"),style:{fontSize:"0.875rem",padding:"0.5rem 1rem"},children:n.poems.alphabetical}),e.jsxs("button",{className:"button button-secondary",onClick:()=>W(!D),style:{fontSize:"0.875rem",padding:"0.5rem 1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ge,{size:16}),n.poems.filters]})]}),D&&e.jsxs("div",{style:{marginTop:"var(--spacing-md)",padding:"var(--spacing-md)",border:"1px solid var(--border-color)",borderRadius:"0.5rem",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"var(--spacing-md)"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",opacity:.7},children:n.poems.dateFrom}),e.jsx("input",{type:"date",className:"input",value:v,onChange:t=>I(t.target.value),style:{fontSize:"0.875rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",opacity:.7},children:n.poems.dateTo}),e.jsx("input",{type:"date",className:"input",value:k,onChange:t=>R(t.target.value),style:{fontSize:"0.875rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",opacity:.7},children:n.poems.minLength}),e.jsx("input",{type:"number",className:"input",placeholder:"0",value:w,onChange:t=>A(t.target.value),style:{fontSize:"0.875rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",opacity:.7},children:n.poems.maxLength}),e.jsx("input",{type:"number",className:"input",placeholder:"∞",value:z,onChange:t=>_(t.target.value),style:{fontSize:"0.875rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",opacity:.7},children:n.poems.mood}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:[e.jsx("button",{className:`button button-secondary${h.length===0?" button-primary":""}`,style:{fontSize:"0.875rem",marginBottom:"0.25rem"},onClick:()=>P([]),type:"button",children:n.poems.allMoods}),ae.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.875rem",marginBottom:"0.25rem"},children:[e.jsx("input",{type:"checkbox",checked:h.includes(t),onChange:()=>P(h.includes(t)?h.filter(s=>s!==t):[...h,t]),style:{accentColor:"var(--accent-color)"}}),n.mood&&n.mood[t]?n.mood[t]:t]},t))]})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsx("button",{className:"button button-secondary",onClick:()=>{I(""),R(""),A(""),_(""),P([])},style:{fontSize:"0.875rem",width:"100%"},children:n.poems.clearFilters})})]})]}),o.length===0?e.jsx("div",{style:{textAlign:"center",padding:"3rem 1rem"},children:e.jsx("p",{className:"text-secondary",children:i?n.poems.noResults:n.poems.noPoems})}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-secondary mb-md",style:{fontSize:"0.875rem"},children:[o.length," ",o.length===1?n.poems.countSingular:n.poems.count,d.length<o.length&&e.jsxs("span",{children:[" (",n.poems.shown," ",d.length,")"]})]}),g&&d.length>0&&e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:a.size===d.length&&d.length>0,onChange:Z,style:{width:"18px",height:"18px"}}),e.jsxs("span",{style:{fontSize:"0.9rem",fontWeight:500},children:["Zaznacz wszystkie (",d.length,")"]})]})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-md)"},children:d.map(t=>e.jsx(je,{content:e.jsxs("div",{className:"tooltip-content-preview",children:[e.jsx("strong",{children:t.title||n.editor.untitled}),e.jsx("br",{}),t.content.substring(0,200),t.content.length>200&&"..."]}),delay:800,children:e.jsxs("div",{className:"card",onClick:()=>!g&&u(t),style:{cursor:g?"default":"pointer",display:"flex",gap:"1rem"},children:[g&&e.jsx("div",{style:{paddingTop:"0.25rem"},children:e.jsx("input",{type:"checkbox",checked:a.has(t.id),onChange:()=>q(t.id),onClick:s=>s.stopPropagation(),style:{width:"20px",height:"20px",cursor:"pointer"}})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{marginBottom:"0.5rem",fontWeight:500},children:t.title||n.editor.untitled}),e.jsx("p",{className:"text-secondary",style:{fontSize:"0.875rem",marginBottom:"1rem"},children:ce(new Date(t.date),"d MMMM yyyy",{locale:N})}),B.enableMarkdown?e.jsx("div",{className:"markdown-preview",style:{lineHeight:1.6,maxHeight:"100px",overflow:"hidden",textOverflow:"ellipsis"},dangerouslySetInnerHTML:{__html:ie.parse(t.content.substring(0,200)+(t.content.length>200?"...":""))}}):e.jsx("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.6,maxHeight:"100px",overflow:"hidden",textOverflow:"ellipsis"},children:t.content}),t.tags.length>0&&e.jsxs("div",{style:{marginTop:"1rem",display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[t.tags.slice(0,3).map(s=>e.jsx("span",{style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--light-border)"},children:s},s)),t.tags.length>3&&e.jsxs("span",{style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--light-border)"},children:["+",t.tags.length-3]})]})]})]})},t.id))}),V&&e.jsxs("button",{className:"button button-secondary",onClick:X,style:{marginTop:"var(--spacing-lg)",width:"100%"},children:[n.poems.loadMore," (",o.length-y," ",n.poems.remaining,")"]})]}),r&&e.jsx(re,{poem:r,onClose:()=>u(null),onUpdate:O}),H&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"var(--bg-primary)",padding:"2rem",borderRadius:"1rem",maxWidth:"400px",width:"90%"},children:[e.jsx("h2",{style:{marginBottom:"1rem",fontSize:"1.25rem"},children:"Dodaj do kolekcji"}),e.jsxs("p",{style:{marginBottom:"1rem",color:"var(--text-secondary)",fontSize:"0.9rem"},children:["Wybierz kolekcję, do której chcesz dodać zaznaczone wiersze (",a.size,")"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1rem"},children:se().map(t=>e.jsx("button",{className:"button button-secondary",onClick:()=>G(t.id),style:{width:"100%",justifyContent:"flex-start"},children:t.name},t.id))}),e.jsx("button",{className:"button button-secondary",onClick:()=>L(!1),style:{width:"100%"},children:"Anuluj"})]})})]})};export{De as default};
