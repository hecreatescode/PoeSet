import{c as u,r as c,j as e,u as ae,b as ie,n as A,e as re}from"./index-0R3IVIiT.js";import{P as oe,M as le}from"./PoemEditor-D0PReKQ4.js";import{X as H}from"./x-D-RmF97G.js";import{T as ce}from"./trash-2-Ct3j1fed.js";import{f as x,p}from"./pl-BLL9vXq1.js";const de=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ye=u("copy",de);const he=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],ge=u("history",he);const fe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],me=u("image",fe);const xe=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],B=u("share-2",xe);const pe=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ue=u("square-pen",pe),U=({isOpen:t,onClose:d,title:h,children:k,footer:g})=>(c.useEffect(()=>{const y=S=>{S.key==="Escape"&&t&&d()};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[t,d]),c.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t?e.jsx("div",{className:"modal-overlay",onClick:d,children:e.jsxs("div",{className:"modal-content",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:h}),e.jsx("button",{className:"modal-close",onClick:d,"aria-label":"Close",children:e.jsx(H,{size:24})})]}),e.jsx("div",{className:"modal-body",children:k}),g&&e.jsx("div",{className:"modal-footer",children:g})]})}):null),ze=({poem:t,onClose:d,onUpdate:h})=>{const[k,g]=c.useState(!1),[y,S]=c.useState(!1),[q,z]=c.useState(!1),[D,M]=c.useState(!1),[V,v]=c.useState(!1),[L,b]=c.useState(!1),{t:r}=ae(),C=ie(),T=n=>{const i={light:{bg:"#f9f7f4",text:"#1a1a1a",accent:"#2c2c2c",secondary:"#666666"},dark:{bg:"#0f1419",text:"#f0ede6",accent:"#d4af37",secondary:"#a8a29e"},sepia:{bg:"#f4ecd8",text:"#3e2723",accent:"#8d6e63",secondary:"#6d4c41"},midnight:{bg:"#0a0e1a",text:"#e0e6f0",accent:"#7aa2f7",secondary:"#8b95a8"},forest:{bg:"#1a2f1a",text:"#e8f5e8",accent:"#90ee90",secondary:"#a8c5a8"},ocean:{bg:"#e8f4ff",text:"#1a3a5a",accent:"#2196f3",secondary:"#5a7a9a"},rose:{bg:"#ffe8f0",text:"#4a1f2e",accent:"#c44569",secondary:"#8a5060"}};return i[n]||i.light},O=async()=>{b(!0);const n=t.theme||C.theme,i=T(n),a=document.createElement("canvas"),s=a.getContext("2d");if(!s){b(!1);return}const N=80,W=800,P=32,_=t.title?60:0,Z=40,ee=(o,m)=>{const $=o.split(" "),I=[];let l="";s.font="18px Georgia, serif";for(const G of $){const R=l+(l?" ":"")+G;s.measureText(R).width>m&&l?(I.push(l),l=G):l=R}return l&&I.push(l),I};s.font="18px Georgia, serif";const w=[],te=t.content.split(`
`);for(const o of te)if(o.trim()==="")w.push("");else{const m=ee(o,W-N*2);w.push(...m)}const ne=w.length*P,se=N*2+_+ne+Z+40;a.width=W,a.height=se,s.fillStyle=i.bg,s.fillRect(0,0,a.width,a.height),s.strokeStyle=i.accent,s.lineWidth=2,s.strokeRect(20,20,a.width-40,a.height-40);let f=N;t.title&&(s.fillStyle=i.text,s.font="bold 28px Georgia, serif",s.textAlign="center",s.fillText(t.title,a.width/2,f+30),f+=_),s.fillStyle=i.text,s.font="18px Georgia, serif",s.textAlign="center";for(const o of w)s.fillText(o,a.width/2,f+P),f+=P;f+=20,s.fillStyle=i.secondary,s.font="14px Georgia, serif",s.fillText(x(new Date(t.date),"d MMMM yyyy",{locale:p}),a.width/2,f),s.fillStyle=i.accent,s.font="12px Georgia, serif",s.fillText("PoeSet",a.width/2,a.height-30),a.toBlob(async o=>{if(!o){b(!1);return}const m=new File([o],`${t.title||"wiersz"}.png`,{type:"image/png"});if(navigator.canShare&&navigator.canShare({files:[m]}))try{await navigator.share({files:[m],title:t.title||"Wiersz",text:"Mój wiersz z PoeSet"})}catch{E(o)}else E(o);b(!1),v(!1)},"image/png")},E=n=>{const i=URL.createObjectURL(n),a=document.createElement("a");a.href=i,a.download=`${t.title||"wiersz"}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(i)},F=()=>{z(!0)},K=()=>{re(t.id),h(),d()},X=()=>{const n=`${t.title}

${t.content}

${x(new Date(t.date),"d MMMM yyyy",{locale:p})}`;navigator.share?navigator.share({title:t.title||"Wiersz",text:n}):(navigator.clipboard.writeText(n),alert("Wiersz skopiowany do schowka!"))},Y=()=>{g(!1),h()},J=()=>{const n=new Date().toISOString(),i={...t,id:`poem_${Date.now()}`,title:`${t.title} (kopia)`,createdAt:n,updatedAt:n,date:n,versions:void 0};A(i),h(),alert("Wiersz zduplikowany!")};if(k)return e.jsx(oe,{poem:t,onSave:Y,onClose:()=>g(!1)});const Q=t.theme||C.theme,j=T(Q);return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:t.theme?j.bg:"var(--bg-primary)",color:t.theme?j.text:"var(--text-primary)",zIndex:1e3,display:"flex",flexDirection:"column"},onClick:()=>S(!y),children:[y&&e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:`1px solid ${t.theme?j.accent+"40":"var(--border-color)"}`,display:"flex",justifyContent:"space-between",alignItems:"center",background:t.theme?j.bg:"var(--bg-primary)"},children:[e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),d()},style:{padding:"0.5rem"},children:e.jsx(H,{size:20})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.versions&&t.versions.length>0&&e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),M(!D)},style:{padding:"0.5rem"},title:r.viewer.versionHistory,children:e.jsx(ge,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),v(!0)},style:{padding:"0.5rem"},title:r.share?.title||"Udostępnij",children:e.jsx(B,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),J()},style:{padding:"0.5rem"},title:"Duplikuj wiersz",children:e.jsx(ye,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),g(!0)},style:{padding:"0.5rem"},children:e.jsx(ue,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),F()},style:{padding:"0.5rem",color:"#dc2626"},children:e.jsx(ce,{size:20})})]})]}),e.jsxs("div",{style:{flex:1,padding:"var(--spacing-xl)",overflow:"auto",display:"flex",flexDirection:"column",justifyContent:"center",maxWidth:"700px",margin:"0 auto",width:"100%"},children:[t.title&&e.jsx("h1",{className:"font-serif",style:{fontSize:"2rem",marginBottom:"var(--spacing-lg)",fontWeight:400,textAlign:"center"},children:t.title}),C.enableMarkdown?e.jsx("div",{className:"font-serif markdown-preview",style:{fontSize:"1.125rem",lineHeight:1.8,marginBottom:"var(--spacing-xl)"},dangerouslySetInnerHTML:{__html:le.parse(t.content)}}):e.jsx("p",{className:"font-serif",style:{fontSize:"1.125rem",lineHeight:1.8,whiteSpace:"pre-wrap",marginBottom:"var(--spacing-xl)"},children:t.content}),e.jsxs("div",{style:{marginTop:"auto"},children:[e.jsx("p",{className:"text-secondary",style:{fontSize:"0.875rem",textAlign:"center",marginBottom:"var(--spacing-md)"},children:x(new Date(t.date),"d MMMM yyyy",{locale:p})}),t.tags.length>0&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",justifyContent:"center"},children:t.tags.map(n=>e.jsx("span",{style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--light-border)"},children:n},n))})]})]}),D&&t.versions&&t.versions.length>0&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"var(--bg-primary)",zIndex:10,overflowY:"auto",padding:"var(--spacing-lg)"},children:e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-lg)"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:300},children:r.viewer.versionHistory}),e.jsx("button",{className:"button button-secondary",onClick:()=>M(!1),style:{padding:"0.5rem"},children:e.jsx(H,{size:20})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-md)"},children:[e.jsxs("div",{style:{padding:"var(--spacing-md)",border:"2px solid var(--primary)",borderRadius:"0.5rem",background:"var(--bg-secondary)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-sm)"},children:e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--primary)"},children:r.viewer.currentVersion}),e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem"},children:x(new Date(t.updatedAt),"d MMM yyyy, HH:mm",{locale:p})})]})}),e.jsx("p",{style:{fontSize:"0.875rem",whiteSpace:"pre-wrap",lineHeight:1.6},children:t.content})]}),t.versions.map((n,i)=>e.jsxs("div",{style:{padding:"var(--spacing-md)",border:"1px solid var(--border-color)",borderRadius:"0.5rem",background:"var(--bg-secondary)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-sm)"},children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:"0.875rem",opacity:.8},children:[r.viewer.version," ",t.versions.length-i]}),e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem"},children:x(new Date(n.timestamp),"d MMM yyyy, HH:mm",{locale:p})})]}),e.jsx("button",{className:"button button-secondary",onClick:()=>{const a={...t,content:n.content,updatedAt:new Date().toISOString()};A(a),h(),M(!1)},style:{fontSize:"0.75rem",padding:"0.375rem 0.75rem"},children:r.viewer.restore})]}),e.jsx("p",{style:{fontSize:"0.875rem",whiteSpace:"pre-wrap",lineHeight:1.6},children:n.content})]},n.id))]})]})}),e.jsx(U,{isOpen:q,onClose:()=>z(!1),title:r.editor.deletePoem||"Usuń wiersz",footer:e.jsxs("div",{style:{display:"flex",gap:"var(--spacing-sm)",justifyContent:"flex-end"},children:[e.jsx("button",{className:"button button-secondary",onClick:()=>z(!1),children:r.editor.cancel||"Anuluj"}),e.jsx("button",{className:"button button-primary",onClick:K,style:{background:"var(--danger)",borderColor:"var(--danger)"},children:r.editor.delete||"Usuń"})]}),children:e.jsx("p",{children:r.editor.deleteConfirm||"Czy na pewno chcesz usunąć ten wiersz? Ta operacja jest nieodwracalna."})}),e.jsx(U,{isOpen:V,onClose:()=>v(!1),title:r.share?.title||"Udostępnij",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-md)"},children:[e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.875rem"},children:r.share?.subtitle||"Wybierz sposób udostępniania wiersza"}),e.jsxs("button",{className:"button button-primary",onClick:()=>O(),disabled:L,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(me,{size:20}),L?r.common?.loading||"Generowanie...":r.share?.generateImage||"Pobierz jako obraz PNG"]}),e.jsxs("button",{className:"button button-secondary",onClick:()=>{X(),v(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(B,{size:20}),r.share?.copyLink||"Kopiuj tekst wiersza"]})]})})]})};export{U as M,ze as P,ue as S};
