import{c as j,r,b as xe,u as we,g as ke,n as te,j as e,o as ve}from"./index-0R3IVIiT.js";import{E as je,a as Se,P as ze,S as Ce,D as ne}from"./index-s_VYoaxZ.js";import{X as H}from"./x-D-RmF97G.js";import{T as Me,C as Ne}from"./tag-DgpikHPA.js";import{P as se}from"./plus-ChnqKPXo.js";const Te=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],$e=j("bold",Te);const Ee=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ie=j("eye-off",Ee);const Pe=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],_e=j("italic",Pe);const De=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Ae=j("lock",De);const Ke=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],Re=j("mic-off",Ke);const Be=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Le=j("mic",Be);const Oe=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],Fe=j("underline",Oe),Ue=i=>{r.useEffect(()=>{const d=n=>{for(const a of i){const l=n.key.toLowerCase()===a.key.toLowerCase(),f=a.ctrlKey===void 0||n.ctrlKey===a.ctrlKey,o=a.shiftKey===void 0||n.shiftKey===a.shiftKey,h=a.altKey===void 0||n.altKey===a.altKey,u=a.metaKey===void 0||n.metaKey===a.metaKey;if(l&&f&&o&&h&&u){const S=n.target;if((S.tagName==="INPUT"||S.tagName==="TEXTAREA"||S.isContentEditable)&&n.key!=="Escape")continue;n.preventDefault(),a.callback(n);break}}};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[i])};class He{static parse(d){let n=d;return n=n.replace(/^### (.*$)/gim,"<h3>$1</h3>"),n=n.replace(/^## (.*$)/gim,"<h2>$1</h2>"),n=n.replace(/^# (.*$)/gim,"<h1>$1</h1>"),n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),n=n.replace(/__(.+?)__/g,"<u>$1</u>"),n=n.replace(/\*(.+?)\*/g,"<em>$1</em>"),n=n.replace(/_(.+?)_/g,"<em>$1</em>"),n=n.replace(/~~(.+?)~~/g,"<del>$1</del>"),n=n.replace(/\[([^\]]+)\]\(([^\)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),n=n.replace(/\n/g,"<br/>"),n}static strip(d){return d.replace(/[#*_~\[\]()]/g,"").replace(/\n/g," ").trim()}}class re{static encoder=new TextEncoder;static decoder=new TextDecoder;static async generateKey(d){const n=await window.crypto.subtle.importKey("raw",this.encoder.encode(d),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:this.encoder.encode("poeset-salt-v1"),iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}static async encrypt(d,n){try{const a=await this.generateKey(n),l=window.crypto.getRandomValues(new Uint8Array(12)),f=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},a,this.encoder.encode(d)),o=new Uint8Array(l.length+f.byteLength);return o.set(l),o.set(new Uint8Array(f),l.length),btoa(String.fromCharCode(...o))}catch(a){throw console.error("Encryption failed:",a),new Error("Failed to encrypt content")}}static async decrypt(d,n){try{const a=await this.generateKey(n),l=Uint8Array.from(atob(d),u=>u.charCodeAt(0)),f=l.slice(0,12),o=l.slice(12),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:f},a,o);return this.decoder.decode(h)}catch(a){throw console.error("Decryption failed:",a),new Error("Failed to decrypt content - wrong password?")}}}const Xe=({poem:i,onSave:d,onClose:n,initialDate:a})=>{const[l,f]=r.useState(i?.title||""),[o,h]=r.useState(i?.content||""),[u,S]=r.useState(i?.tags||[]),[N,Z]=r.useState(""),[T,oe]=r.useState(i?.date.split("T")[0]||a||new Date().toISOString().split("T")[0]),[w,P]=r.useState(i?.mood),[p,x]=r.useState(i?.theme),[V,ae]=r.useState(!1),[W,ie]=r.useState(!1),[A,ce]=r.useState(!1),[K,le]=r.useState(!1),[de,R]=r.useState(!1),[B,L]=r.useState(""),[ue,G]=r.useState(!1),[z,me]=r.useState(!1),[C,q]=r.useState(i?.isEncrypted||!1),[pe,$]=r.useState(!1),[E,_]=r.useState(""),[k,O]=r.useState(!1),I=r.useRef(null),D=r.useRef(i?.id||""),M=r.useRef(null),[b,ye]=r.useState(xe()),{t:m}=we(),ge=r.useMemo(()=>"webkitSpeechRecognition"in window||"SpeechRecognition"in window,[]),X=()=>{const t=B.trim();if(!t)return;const s=b.customMoods||[];if(s.includes(t)||ne.includes(t))return;const c=[...s,t],y={...b,customMoods:c};ve(y),ye(y),P(t),L(""),R(!1)},Y=r.useMemo(()=>{if(!N)return[];const t=ke(),s=new Set;return t.forEach(c=>{c.tags.forEach(y=>s.add(y))}),Array.from(s).filter(c=>c.toLowerCase().includes(N.toLowerCase())&&!u.includes(c)).slice(0,5)},[N,u]);r.useEffect(()=>{D.current||(D.current=`poem-${Date.now()}-${Math.random().toString(36).substr(2,9)}`)},[]),r.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const t=window.webkitSpeechRecognition||window.SpeechRecognition,s=new t;s.continuous=!0,s.interimResults=!0,s.lang=b.language==="pl"?"pl-PL":"en-US",s.onresult=c=>{let y="";for(let g=c.resultIndex;g<c.results.length;g++){const v=c.results[g][0].transcript;c.results[g].isFinal&&(y+=v+" ")}y&&h(g=>g+y)},s.onerror=c=>{console.error("Speech recognition error:",c.error),O(!1)},s.onend=()=>{k&&s.start()},M.current=s}return()=>{M.current&&M.current.stop()}},[b.language,k]);const he=r.useCallback(()=>{M.current&&(k?(M.current.stop(),O(!1)):(M.current.start(),O(!0)))},[k]);r.useEffect(()=>{if(o.trim())return I.current&&clearTimeout(I.current),I.current=window.setTimeout(()=>{const t=new Date().toISOString(),s={id:D.current,title:l.trim()||"Bez tytułu",content:o.trim(),date:`${T}T${new Date().toISOString().split("T")[1]}`,tags:u,mood:w,theme:p,collectionIds:i?.collectionIds||[],createdAt:i?.createdAt||t,updatedAt:t};te(s),G(!0),setTimeout(()=>G(!1),2e3)},3e3),()=>{I.current&&clearTimeout(I.current)}},[l,o,u,w,p,T,i]);const J=r.useCallback(()=>{if(!o.trim())return;const t=new Date().toISOString(),s={id:D.current,title:l.trim()||"Bez tytułu",content:o.trim(),date:`${T}T${new Date().toISOString().split("T")[1]}`,tags:u,mood:w,theme:p,collectionIds:i?.collectionIds||[],createdAt:i?.createdAt||t,updatedAt:t};te(s),d(s)},[o,l,T,u,w,p,i,d]),F=t=>{const s=(t||N).trim();s&&!u.includes(s)&&(S([...u,s]),Z(""))},be=t=>{S(u.filter(s=>s!==t))},U=t=>{const s=document.querySelector("textarea");if(!s)return;const c=s.selectionStart,y=s.selectionEnd,g=o.substring(c,y);if(!g)return;let v="";switch(t){case"bold":v=`**${g}**`;break;case"italic":v=`*${g}*`;break;case"underline":v=`__${g}__`;break}const fe=o.substring(0,c)+v+o.substring(y);h(fe),setTimeout(()=>{s.focus(),s.setSelectionRange(c,c+v.length)},0)},Q=async()=>{if(E.trim())try{const t=await re.encrypt(o,E);h(t),q(!0),$(!1),_("")}catch{alert("Błąd szyfrowania")}},ee=async()=>{if(E.trim())try{const t=await re.decrypt(o,E);h(t),q(!1),$(!1),_("")}catch{alert("Nieправидłowe hasło")}};return Ue([{key:"s",ctrlKey:!0,callback:J,description:"Save (Ctrl+S)"},{key:"Escape",callback:n,description:"Close (Esc)"}]),e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"var(--light-bg)",zIndex:1e3,display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("button",{className:"button button-secondary",onClick:n,style:{padding:"0.5rem"},children:e.jsx(H,{size:20})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[ue&&e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginRight:"0.5rem"},children:"✓ Zapisano"}),b.enableMarkdown&&e.jsx("button",{className:"button button-secondary",onClick:()=>me(!z),style:{padding:"0.5rem"},title:z?"Ukryj podgląd":"Pokaż podgląd Markdown",children:z?e.jsx(Ie,{size:20}):e.jsx(je,{size:20})}),ge&&e.jsx("button",{className:`button ${k?"button-primary":"button-secondary"}`,onClick:he,style:{padding:"0.5rem"},title:k?"Zatrzymaj dyktowanie":"Rozpocznij dyktowanie",children:k?e.jsx(Re,{size:20}):e.jsx(Le,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:()=>ae(!V),style:{padding:"0.5rem"},children:e.jsx(Me,{size:20})}),e.jsx("button",{className:`button ${C?"button-primary":"button-secondary"}`,onClick:()=>$(!0),style:{padding:"0.5rem"},title:C?"Wiersz zaszyfrowany":"Zaszyfruj wiersz",children:e.jsx(Ae,{size:20})}),e.jsx("button",{className:`button ${A?"button-primary":"button-secondary"}`,onClick:()=>ce(!A),style:{padding:"0.5rem"},title:"Nastrój wiersza",children:e.jsx(Se,{size:20})}),e.jsx("button",{className:`button ${K?"button-primary":"button-secondary"}`,onClick:()=>le(!K),style:{padding:"0.5rem"},title:"Motyw wiersza",children:e.jsx(ze,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:()=>ie(!W),style:{padding:"0.5rem"},children:e.jsx(Ne,{size:20})}),e.jsxs("button",{className:"button button-primary",onClick:J,disabled:!o.trim(),children:[e.jsx(Ce,{size:20}),"Zapisz"]})]})]}),V&&e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsxs("div",{style:{position:"relative",flex:1},children:[e.jsx("input",{type:"text",className:"input",placeholder:"Dodaj tag...",value:N,onChange:t=>Z(t.target.value),onKeyPress:t=>t.key==="Enter"&&F(),style:{padding:"0.5rem",width:"100%"}}),Y.length>0&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"0.25rem",background:"var(--bg-primary)",border:"1px solid var(--border-color)",borderRadius:"0.5rem",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:Y.map(t=>e.jsx("div",{onClick:()=>F(t),style:{padding:"0.75rem",cursor:"pointer",borderBottom:"1px solid var(--border-color)",fontSize:"0.875rem"},onMouseEnter:s=>{s.currentTarget.style.background="var(--bg-secondary)"},onMouseLeave:s=>{s.currentTarget.style.background="transparent"},children:t},t))})]}),e.jsx("button",{className:"button button-primary",onClick:()=>F(),children:"Dodaj"})]}),u.length>0&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:u.map(t=>e.jsxs("span",{style:{fontSize:"0.875rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--light-border)",display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},onClick:()=>be(t),children:[t," ",e.jsx(H,{size:14})]},t))})]}),A&&e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",opacity:.7},children:m.filters.mood}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"0.5rem"},children:[e.jsx("button",{className:`button ${w?"button-secondary":"button-primary"}`,onClick:()=>P(void 0),style:{fontSize:"0.875rem"},children:m.poems.allMoods}),ne.map(t=>e.jsx("button",{className:`button ${w===t?"button-primary":"button-secondary"}`,onClick:()=>P(t),style:{fontSize:"0.875rem"},children:m.mood[t]},t)),(b.customMoods||[]).map(t=>e.jsx("button",{className:`button ${w===t?"button-primary":"button-secondary"}`,onClick:()=>P(t),style:{fontSize:"0.875rem"},children:t},t))]}),e.jsx("div",{style:{marginTop:"var(--spacing-md)",borderTop:"1px solid var(--light-border)",paddingTop:"var(--spacing-md)"},children:de?e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",className:"input",value:B,onChange:t=>L(t.target.value),onKeyPress:t=>t.key==="Enter"&&X(),placeholder:m.editor?.moodPlaceholder||"Nazwa nastroju...",style:{flex:1,padding:"0.5rem"},autoFocus:!0}),e.jsx("button",{className:"button button-primary",onClick:X,disabled:!B.trim(),style:{padding:"0.5rem"},children:e.jsx(se,{size:18})}),e.jsx("button",{className:"button button-secondary",onClick:()=>{R(!1),L("")},style:{padding:"0.5rem"},children:e.jsx(H,{size:18})})]}):e.jsxs("button",{className:"button button-secondary",onClick:()=>R(!0),style:{fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(se,{size:16}),m.editor?.addCustomMood||"Dodaj własny nastrój"]})})]}),K&&e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)"},children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",opacity:.7},children:m.editor?.poemTheme||"Motyw wiersza"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(100px, 1fr))",gap:"0.5rem"},children:[e.jsx("button",{className:`button ${p?"button-secondary":"button-primary"}`,onClick:()=>x(void 0),style:{fontSize:"0.875rem"},children:m.editor?.defaultTheme||"Domyślny"}),e.jsx("button",{className:`button ${p==="light"?"button-primary":"button-secondary"}`,onClick:()=>x("light"),style:{fontSize:"0.875rem"},children:m.themes.light}),e.jsx("button",{className:`button ${p==="dark"?"button-primary":"button-secondary"}`,onClick:()=>x("dark"),style:{fontSize:"0.875rem"},children:m.themes.dark}),e.jsx("button",{className:`button ${p==="sepia"?"button-primary":"button-secondary"}`,onClick:()=>x("sepia"),style:{fontSize:"0.875rem"},children:m.themes.sepia}),e.jsx("button",{className:`button ${p==="midnight"?"button-primary":"button-secondary"}`,onClick:()=>x("midnight"),style:{fontSize:"0.875rem"},children:m.themes.midnight}),e.jsx("button",{className:`button ${p==="forest"?"button-primary":"button-secondary"}`,onClick:()=>x("forest"),style:{fontSize:"0.875rem"},children:m.themes.forest}),e.jsx("button",{className:`button ${p==="ocean"?"button-primary":"button-secondary"}`,onClick:()=>x("ocean"),style:{fontSize:"0.875rem"},children:m.themes.ocean}),e.jsx("button",{className:`button ${p==="rose"?"button-primary":"button-secondary"}`,onClick:()=>x("rose"),style:{fontSize:"0.875rem"},children:m.themes.rose})]})]}),W&&e.jsx("div",{style:{padding:"var(--spacing-md)",borderBottom:"1px solid var(--light-border)"},children:e.jsx("input",{type:"date",className:"input",value:T,onChange:t=>oe(t.target.value),style:{padding:"0.5rem"}})}),pe&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>$(!1),children:e.jsxs("div",{style:{background:"var(--bg-primary)",padding:"var(--spacing-lg)",borderRadius:"0.5rem",maxWidth:"400px",width:"90%"},onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{style:{marginBottom:"var(--spacing-md)"},children:C?"Odszyfruj wiersz":"Zaszyfruj wiersz"}),e.jsx("input",{type:"password",className:"input",placeholder:"Hasło",value:E,onChange:t=>_(t.target.value),onKeyPress:t=>t.key==="Enter"&&(C?ee():Q()),style:{marginBottom:"var(--spacing-md)"}}),e.jsxs("div",{style:{display:"flex",gap:"var(--spacing-sm)"},children:[e.jsx("button",{className:"button button-primary",onClick:C?ee:Q,style:{flex:1},children:C?"Odszyfruj":"Zaszyfruj"}),e.jsx("button",{className:"button button-secondary",onClick:()=>{$(!1),_("")},style:{flex:1},children:"Anuluj"})]})]})}),e.jsxs("div",{style:{flex:1,padding:"var(--spacing-xl)",overflow:"auto",display:z&&b.enableMarkdown?"grid":"block",gridTemplateColumns:z&&b.enableMarkdown?"1fr 1fr":"1fr",gap:"var(--spacing-lg)"},children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",className:"input font-serif",placeholder:"Tytuł (opcjonalny)",value:l,onChange:t=>f(t.target.value),style:{fontSize:"1.5rem",fontWeight:500,marginBottom:"var(--spacing-lg)",border:"none",padding:"0"}}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem",marginBottom:"var(--spacing-md)",paddingBottom:"var(--spacing-sm)",borderBottom:"1px solid var(--light-border)"},children:[e.jsx("button",{className:"button button-secondary",onClick:()=>U("bold"),style:{padding:"0.5rem",fontSize:"0.875rem"},title:"Pogrubienie (zaznacz tekst)",children:e.jsx($e,{size:16})}),e.jsx("button",{className:"button button-secondary",onClick:()=>U("italic"),style:{padding:"0.5rem",fontSize:"0.875rem"},title:"Kursywa (zaznacz tekst)",children:e.jsx(_e,{size:16})}),e.jsx("button",{className:"button button-secondary",onClick:()=>U("underline"),style:{padding:"0.5rem",fontSize:"0.875rem"},title:"Podkreślenie (zaznacz tekst)",children:e.jsx(Fe,{size:16})}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",marginLeft:"0.5rem"},children:"Zaznacz tekst i kliknij aby sformatować"})]}),e.jsx("textarea",{className:"input textarea font-serif",placeholder:"Zacznij pisać wiersz...",value:o,onChange:t=>h(t.target.value),style:{border:"none",padding:"0",fontSize:"1.125rem",lineHeight:1.8,minHeight:"400px"},autoFocus:!0})]}),z&&b.enableMarkdown&&e.jsxs("div",{style:{borderLeft:"2px solid var(--light-border)",paddingLeft:"var(--spacing-lg)"},children:[e.jsx("h3",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:"var(--spacing-lg)",opacity:.7},children:l||"Bez tytułu"}),e.jsx("div",{className:"markdown-preview",style:{fontSize:"1.125rem",lineHeight:1.8,whiteSpace:"pre-wrap"},dangerouslySetInnerHTML:{__html:He.parse(o)}})]})]})]})};export{He as M,Xe as P,Ue as u};
