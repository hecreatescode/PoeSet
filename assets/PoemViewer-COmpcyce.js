import{c as k,r as d,j as e,u as ce,n as de,d as ye,o as q,_ as H,p as ge}from"./index-Couu5Qb6.js";import{P as he,M as xe}from"./PoemEditor-DBR0BIny.js";import{T as me}from"./Modal-Ca8Nt5oi.js";import{X as L}from"./x-B_36fqTD.js";import{f as j,p as w}from"./pl-Bq6CFB2J.js";const fe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],pe=k("copy",fe);const ue=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],be=k("history",ue);const ve=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],je=k("image",ve);const we=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],F=k("share-2",we);const ke=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Se=k("square-pen",ke),X=({isOpen:t,onClose:y,title:x,children:N,footer:m})=>(d.useEffect(()=>{const g=_=>{_.key==="Escape"&&t&&y()};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[t,y]),d.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t?e.jsx("div",{className:"modal-overlay",onClick:y,children:e.jsxs("div",{className:"modal-content",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:x}),e.jsx("button",{className:"modal-close",onClick:y,"aria-label":"Close",children:e.jsx(L,{size:24})})]}),e.jsx("div",{className:"modal-body",children:N}),m&&e.jsx("div",{className:"modal-footer",children:m})]})}):null),De=({poem:t,onClose:y,onUpdate:x})=>{const[N,m]=d.useState(!1),[g,_]=d.useState(!1),[K,D]=d.useState(!1),[W,I]=d.useState(!1),[Y,h]=d.useState(!1),[$,S]=d.useState(!1),{t:a}=ce(),{settings:z}=de(),R=n=>{const i={light:{bg:"#f9f7f4",text:"#1a1a1a",accent:"#2c2c2c",secondary:"#666666"},dark:{bg:"#0f1419",text:"#f0ede6",accent:"#d4af37",secondary:"#a8a29e"},sepia:{bg:"#f4ecd8",text:"#3e2723",accent:"#8d6e63",secondary:"#6d4c41"},midnight:{bg:"#0a0e1a",text:"#e0e6f0",accent:"#7aa2f7",secondary:"#8b95a8"},forest:{bg:"#1a2f1a",text:"#e8f5e8",accent:"#90ee90",secondary:"#a8c5a8"},ocean:{bg:"#e8f4ff",text:"#1a3a5a",accent:"#2196f3",secondary:"#5a7a9a"},rose:{bg:"#ffe8f0",text:"#4a1f2e",accent:"#c44569",secondary:"#8a5060"}};return i[n]||i.light},J=async()=>{S(!0);const n=t.theme||z.theme,i=R(n),r=document.createElement("canvas"),s=r.getContext("2d");if(!s){S(!1);return}const l=1080,u=1350,b=3,M=80,ae=l-M*2,T=40,G=t.title?80:0,ie=50,re=(o,p)=>{const U=o.split(" "),E=[];let c="";s.font="18px Georgia, serif";for(const V of U){const O=c+(c?" ":"")+V;s.measureText(O).width>p&&c?(E.push(c),c=V):c=O}return c&&E.push(c),E};s.font="18px Georgia, serif";const P=[],oe=t.content.split(`
`);for(const o of oe)if(o.trim()==="")P.push("");else{const p=re(o,ae-M*2);P.push(...p)}const le=P.length*T,v=M*2+G+le+ie+40;r.width=l*b,r.height=Math.max(u*b,v*b),r.style.width=`${l}px`,r.style.height=`${Math.max(u,v)}px`,s.setTransform(b,0,0,b,0,0),s.fillStyle=i.bg,s.fillRect(0,0,l,Math.max(u,v)),s.strokeStyle=i.accent,s.lineWidth=2,s.strokeRect(20,20,l-40,Math.max(u,v)-40);let f=M;t.title&&(s.fillStyle=i.text,s.font="bold 36px Georgia, serif",s.textAlign="center",s.fillText(t.title,l/2,f+40),f+=G),s.fillStyle=i.text,s.font="18px Georgia, serif",s.textAlign="center";for(const o of P)s.fillText(o,l/2,f+T),f+=T;f+=20,s.fillStyle=i.secondary,s.font="16px Georgia, serif",s.fillText(j(new Date(t.date),"d MMMM yyyy",{locale:w}),l/2,f),s.fillStyle=i.accent,s.font="14px Georgia, serif",s.fillText("PoeSet",l/2,Math.max(u,v)-30),r.toBlob(async o=>{if(!o){S(!1);return}const p=new File([o],`${t.title||"wiersz"}.png`,{type:"image/png"});if(navigator.canShare&&navigator.canShare({files:[p]}))try{await navigator.share({files:[p],title:t.title||"Wiersz",text:"Mój wiersz z PoeSet"})}catch{A(o)}else A(o);S(!1),h(!1)},"image/png")},A=n=>{const i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=`${t.title||"wiersz"}.png`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)},Q=()=>{D(!0)},Z=()=>{ge(t.id),x(),y()},{notify:B}=ye(),ee=()=>{const n=`${t.title}

${t.content}

${j(new Date(t.date),"d MMMM yyyy",{locale:w})}`;navigator.share?navigator.share({title:t.title||"Wiersz",text:n}):(navigator.clipboard.writeText(n),B("Wiersz skopiowany do schowka!","success"))},te=()=>{m(!1),x()},ne=()=>{const n=new Date().toISOString(),i={...t,id:`poem_${Date.now()}`,title:`${t.title} (kopia)`,createdAt:n,updatedAt:n,date:n,versions:void 0};q(i),x(),B("Wiersz zduplikowany!","success")};if(N)return e.jsx("div",{style:{maxWidth:700,margin:"0 auto",background:"var(--bg-secondary)",borderRadius:"var(--radius-md)",boxShadow:"0 2px 16px rgba(0,0,0,0.10)",padding:"var(--spacing-lg)",marginTop:"var(--spacing-lg)"},children:e.jsx(he,{poem:t,onSave:te,onClose:()=>m(!1)})});const se=t.theme||z.theme,C=R(se);return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:t.theme?C.bg:"var(--bg-primary)",color:t.theme?C.text:"var(--text-primary)",zIndex:1e3,display:"flex",flexDirection:"column"},onClick:()=>_(!g),children:[g&&e.jsxs("div",{style:{padding:"var(--spacing-md)",borderBottom:`1px solid ${t.theme?C.accent+"40":"var(--border-color)"}`,display:"flex",justifyContent:"space-between",alignItems:"center",background:t.theme?C.bg:"var(--bg-primary)"},children:[e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),y()},style:{padding:"0.5rem"},children:e.jsx(L,{size:20})}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[t.versions&&t.versions.length>0&&e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),I(!W)},style:{padding:"0.5rem"},title:a.viewer.versionHistory,children:e.jsx(be,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),h(!0)},style:{padding:"0.5rem"},title:a.share?.title||"Udostępnij",children:e.jsx(F,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),ne()},style:{padding:"0.5rem"},title:"Duplikuj wiersz",children:e.jsx(pe,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),m(!0)},style:{padding:"0.5rem"},children:e.jsx(Se,{size:20})}),e.jsx("button",{className:"button button-secondary",onClick:n=>{n.stopPropagation(),Q()},style:{padding:"0.5rem",color:"#dc2626"},children:e.jsx(me,{size:20})})]})]}),e.jsxs("div",{style:{flex:1,padding:"var(--spacing-xl)",overflow:"auto",display:"flex",flexDirection:"column",justifyContent:"center",maxWidth:"700px",margin:"0 auto",width:"100%"},children:[t.title&&e.jsx("h1",{className:"font-serif poem-title-marked",style:{fontSize:"2rem",marginBottom:"var(--spacing-lg)",fontWeight:400,textAlign:"center",position:"relative",zIndex:1,display:"block"},children:(z.titleDecorator||"„{title}”").replace("{title}",t.title)}),z.enableMarkdown?e.jsx("div",{className:"font-serif markdown-preview",style:{fontSize:"1.125rem",lineHeight:1.8,marginBottom:"var(--spacing-xl)"},dangerouslySetInnerHTML:{__html:xe.parse(t.content)}}):e.jsx("p",{className:"font-serif",style:{fontSize:"1.125rem",lineHeight:1.8,whiteSpace:"pre-wrap",marginBottom:"var(--spacing-xl)"},children:t.content}),e.jsxs("div",{style:{marginTop:"auto"},children:[e.jsx("p",{className:"text-secondary",style:{fontSize:"0.875rem",textAlign:"center",marginBottom:"var(--spacing-md)"},children:j(new Date(t.date),"d MMMM yyyy",{locale:w})}),t.moods&&t.moods.length>0&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",justifyContent:"center",marginBottom:t.tags.length>0?"0.5rem":0},children:t.moods.map(n=>e.jsx("span",{style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--accent-color)",color:"white",letterSpacing:.5},children:a.mood&&a.mood[n]?a.mood[n]:n},n))}),t.tags.length>0&&e.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",justifyContent:"center"},children:t.tags.map(n=>e.jsx("span",{style:{fontSize:"0.75rem",padding:"0.25rem 0.75rem",borderRadius:"var(--radius-full)",background:"var(--light-border)"},children:n},n))})]})]}),W&&t.versions&&t.versions.length>0&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"var(--bg-primary)",zIndex:10,overflowY:"auto",padding:"var(--spacing-lg)"},children:e.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-lg)"},children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:300},children:a.viewer.versionHistory}),e.jsx("button",{className:"button button-secondary",onClick:()=>I(!1),style:{padding:"0.5rem"},children:e.jsx(L,{size:20})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-md)"},children:[e.jsxs("div",{style:{padding:"var(--spacing-md)",border:"2px solid var(--primary)",borderRadius:"0.5rem",background:"var(--bg-secondary)"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-sm)"},children:e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"0.875rem",fontWeight:600,color:"var(--primary)"},children:a.viewer.currentVersion}),e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem"},children:j(new Date(t.updatedAt),"d MMM yyyy, HH:mm",{locale:w})})]})}),e.jsx("p",{style:{fontSize:"0.875rem",whiteSpace:"pre-wrap",lineHeight:1.6},children:t.content})]}),t.versions.map((n,i)=>e.jsxs("div",{style:{padding:"var(--spacing-md)",border:"1px solid var(--border-color)",borderRadius:"0.5rem",background:"var(--bg-secondary)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--spacing-sm)"},children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:"0.875rem",opacity:.8},children:[a.viewer.version," ",t.versions.length-i]}),e.jsx("p",{style:{fontSize:"0.75rem",opacity:.6,marginTop:"0.25rem"},children:j(new Date(n.timestamp),"d MMM yyyy, HH:mm",{locale:w})})]}),e.jsx("button",{className:"button button-secondary",onClick:()=>{const r={...t,content:n.content,updatedAt:new Date().toISOString()};q(r),x(),I(!1)},style:{fontSize:"0.75rem",padding:"0.375rem 0.75rem"},children:a.viewer.restore})]}),e.jsx("p",{style:{fontSize:"0.875rem",whiteSpace:"pre-wrap",lineHeight:1.6},children:n.content})]},n.id))]})]})}),e.jsx(X,{isOpen:K,onClose:()=>D(!1),title:a.editor.deletePoem||"Usuń wiersz",footer:e.jsxs("div",{style:{display:"flex",gap:"var(--spacing-sm)",justifyContent:"flex-end"},children:[e.jsx("button",{className:"button button-secondary",onClick:()=>D(!1),children:a.editor.cancel||"Anuluj"}),e.jsx("button",{className:"button button-primary",onClick:Z,style:{background:"var(--danger)",borderColor:"var(--danger)"},children:a.editor.delete||"Usuń"})]}),children:e.jsx("p",{children:a.editor.deleteConfirm||"Czy na pewno chcesz usunąć ten wiersz? Ta operacja jest nieodwracalna."})}),e.jsx(X,{isOpen:Y,onClose:()=>h(!1),title:a.share?.title||"Udostępnij",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"var(--spacing-md)"},children:[e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.875rem"},children:a.share?.subtitle||"Wybierz sposób udostępniania wiersza"}),e.jsxs("button",{className:"button button-primary",onClick:()=>J(),disabled:$,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(je,{size:20}),$?a.common?.loading||"Generowanie...":a.share?.generateImage||"Pobierz jako obraz PNG"]}),e.jsxs("button",{className:"button button-secondary",onClick:()=>{ee(),h(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(F,{size:20}),a.share?.copyLink||"Kopiuj tekst wiersza"]}),e.jsxs("button",{className:"button button-secondary",onClick:()=>{H(async()=>{const{ExportService:n}=await import("./export-Ce8KcEAY.js");return{ExportService:n}},[]).then(({ExportService:n})=>{n.downloadFile(n.exportToMarkdown([t]),`${t.title||"wiersz"}.md`,"text/markdown")}),h(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontWeight:600},children:"MD"})," Pobierz Markdown"]}),e.jsxs("button",{className:"button button-secondary",onClick:()=>{H(async()=>{const{ExportService:n}=await import("./export-Ce8KcEAY.js");return{ExportService:n}},[]).then(({ExportService:n})=>{n.exportToPDF([t])}),h(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontWeight:600},children:"PDF"})," Pobierz PDF"]}),e.jsxs("button",{className:"button button-secondary",onClick:()=>{H(async()=>{const{ExportService:n}=await import("./export-Ce8KcEAY.js");return{ExportService:n}},[]).then(({ExportService:n})=>{n.exportToDocx(t,`${t.title||"wiersz"}.docx`)}),h(!1)},style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontWeight:600},children:"DOCX"})," Pobierz DOCX"]})]})})]})};export{X as M,De as P,Se as S};
